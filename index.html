
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Realidade Aumentada com Modelo Blender</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/jeromeetienne/AR.js/2.0.8/aframe/build/aframe-ar.js"></script>
</head>
<body>
    <!-- renderer="logarithmicDepthBuffer: true;" -->
    <a-scene arjs
    embedded
    vr-mode-ui="enabled: false"
    gesture-detector
    id="scene">
    <!-- animation__spin="property: rotation; to: 0 360 0; loop: true; dur: 10000" -->
        <a-marker preset="hiro">
            <!-- Carregue o modelo Blender usando o atributo gltf-model -->
            <a-entity id="model" 
            gltf-model="url(FPFmdel.glb)" 
            scale="0.5 0.5 0.5"
            rotation="0 0 0"
            sensor-orientation>
      <!-- Adicione um objeto de colisão para capturar cliques -->
      <!-- <a-box position="0 0 0" depth="0.2" height="0.2" width="0.2" material="opacity: 0;"></a-box> -->
        </a-marker>
        <a-entity camera></a-entity>
    </a-scene>

    <script>
        var isTouching = false;
        var initialTouchDistance = 0;

        // Adicione eventos de toque
        document.addEventListener('touchstart', function(event) {
            if (event.touches.length === 2) {
                isTouching = true;
                initialTouchDistance = Math.hypot(
                    event.touches[0].clientX - event.touches[1].clientX,
                    event.touches[0].clientY - event.touches[1].clientY
                );
            }
        });

        document.addEventListener('touchmove', function(event) {
            if (isTouching && event.touches.length === 2) {
                var currentTouchDistance = Math.hypot(
                    event.touches[0].clientX - event.touches[1].clientX,
                    event.touches[0].clientY - event.touches[1].clientY
                );

                var zoomAmount = currentTouchDistance - initialTouchDistance;

                var camera = document.querySelector('a-entity[camera]');
                var currentPosition = camera.getAttribute('position');
                currentPosition.z -= zoomAmount / 100; // Ajuste a sensibilidade do zoom aqui
                camera.setAttribute('position', currentPosition);

                initialTouchDistance = currentTouchDistance;
            }
        });

        document.addEventListener('touchend', function(event) {
            isTouching = false;
        });


        // Evento que pega gesto de rotação
        AFRAME.registerComponent('sensor-orientation', {
            init: function () {
                print('iniciando o evento de rotação')
                window.addEventListener('deviceorientation', this.rotateModel.bind(this), false);
            },
            rotateModel: function (event) {
                // Obter os ângulos de inclinação do dispositivo
                var beta = event.beta; // Inclinação para frente/trás
                var gamma = event.gamma; // Inclinação para esquerda/direita

                // Rotação automática do modelo com base nos ângulos de inclinação
                var car = document.getElementById('model');
                car.object3D.rotation.y = -gamma * Math.PI / 180; // Rotação em relação ao eixo y
                car.object3D.rotation.x = beta * Math.PI / 180; // Rotação em relação ao eixo x

                alert(`${gamma} -- ${beta}`);
            }
        });
    </script>
</body>
</html>